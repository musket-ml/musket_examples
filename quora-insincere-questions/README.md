# Musket example for Severstal competition

This is Musket example for [Severstal competition](https://www.kaggle.com/c/severstal-steel-defect-detection/overview)

Competition is aimed at detecting different defects on steel plate photos.

We decided to detect defects in two steps:

* Multiclass Classifier ( _experiments_ / _classify_) will tell us, which types of defects are present on the current image
* Segmentation (_experiments/segment1-segment4_) is responsible for detecting corresponding type of defect, from 1 to 4

## Launching from console

* Ensure you have Python 3.6, as well as Musket and Kaggle python packages with their dependencies installed, Keras installed and configured
* In experiment root folder - `severstal` - in command line type `musket fit -d`. `-d` tells Musket to download dependencies - Kaggle Severstal dataset in this case - before launching experiments

## Launching from DS IDE

* Import project using _Import > Existing projects into workspace_
* In PyDev explorer, richt-click the newly imported project, choose _Import..._, in the opened dialog choose _Musket > Kaggle Dataset_. In the top of the opened wizard choose _Competition_, search for `severstal` and choose found competition in the table below - should be `severstal-steel-defect-detection`. Press OK and wait until competition data will be download and unpacked.
* Open `modules/prepare_datasets.py` from the imported project and launch to prepare image classification dataset.
* In Musket perspective in PyDev Package Explorer or another explorer view right-click _exeriments_ subnode and choose "Show Experiments"
* In opened Experiments view select all experiments, right-click and choose "Launch experiments"
* In opened Launch Settings dialog configure necessary parameters and click OK

## Modules and used capabilities

### datasets.py

This file contains dataset definions - methods decorated with `@datasets.dataset_provider(origin=...,kind=...)`. Such definitions can be generated by IDE based on a dataset

## prepare_datasets.py

Sometimes we need to form some custom dataset changing filtering downloaded input dataset. For this purpose we use a method decorated with `@after_download` decoration.
In this case we use such method to create subdataset _classify.csv_ for out classification experiment

## augmentation.py

Class no. 2 has pretty few samples in it, but the defect of this class is always vertical or almost vertical. Based on that we created special augmenter for it, which does cyclic translation/wrapping of input image together with segmentation mask to avoid overfitting - "remembering" particular defects by a network. To achieve this, we define the class named `AffineWithPadding`. Custom augmenter class should always be a child of `imgaug`'s `Affine` class decorated with `@augmenters.augmenter`

  

